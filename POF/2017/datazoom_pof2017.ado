program datazoom_pof2017
syntax, [trs(string)] [id(string)] [sel(string)] [std] original(string) saving(string) [english]

if ("`sel'" != "" | "`std'" != "") & "`id'" != "pess"{
	local trs tr2 tr3 tr4 tr5 tr6 tr7 tr14 tr15 // Apenas TRs de despesas e rendimentos
}
else if ("`sel'" != "" | "`std'" != "") & "`id'" == "pess"{
	local trs tr4 tr6 tr7 tr15 // Mantém somente os TRs individuais
}	
else if "`trs'" == "" local trs tr1 tr2 tr3 tr4 tr5 tr6 tr7 tr8 tr9 tr10 tr11 tr12 tr13 tr14 tr15

foreach tr in `trs'{
	tempfile base_`tr' // Temps têm que ser criadas fora da função de load para serem recuperadas
	local bases `bases' `base_`tr'' // Local que armazena todas essas bases
}

load_pof17, trs(`trs') temps(`bases') original(`original') `english'

* Caso só se queira os TRs crus, acaba por aqui
if "`sel'" == "" & "`std'" == ""{
	
	cd "`saving'"

	foreach tr in `trs'{
		use `base_`tr'', clear
		save pof2017_`tr', replace
	}
}

* Caso contrário, falta aplicar a função de bases selecionadas ou a de bases padronizadas

else if "`sel'" != ""{
	pofsel_17, id(`id') sel(`sel') trs(`trs') temps(`bases') original(`original') `english'
	
	cd "`saving'"
	save pof2017_`id'_custom, replace
}
else{
	pofstd_17, id(`id') trs(`trs') temps(`bases') original(`original') `english'
	
	cd "`saving'"
	save "pof2017_`id'_standard", replace
	
	if "`id'" == ""{
		di as error "option {bf: id()} required"
		exit 198
	}
}

di as result "As bases foram salvas em `saving'"

end

program load_pof17 // Armazena as bases nas temps fornecidas
syntax, temps(string) original(string) trs(string) [english]

if "`english'" != "" local lang "_en"

cd "`original'"

local registros "MORADOR DESPESA_COLETIVA CADERNETA_COLETIVA DESPESA_INDIVIDUAL ALUGUEL_ESTIMADO RENDIMENTO_TRABALHO OUTROS_RENDIMENTOS DOMICILIO INVENTARIO CARACTERISTICAS_DIETA CONSUMO_ALIMENTAR CONDICOES_VIDA RESTRICAO_PRODUTOS_SERVICOS_SAUDE SERVICO_NAO_MONETARIO_POF2 SERVICO_NAO_MONETARIO_POF4"

forvalues i = 1/`: word count `trs''{
	
	local tr: word `i' of `trs'
	local base: word `i' of `temps'
	
	local num = substr("`tr'", 3, .) // tr1 -> 1, tr11 -> 11
	local registro: word `num' of `registros'
	
	di as input "Extraindo TR`num': `registro'"
	
	tempfile dic

	findfile dict.dta

	read_compdct, compdct("`r(fn)'") dict_name("pof2017_`tr'`lang'") out("`dic'")
	
	qui infile using `dic', using("`original'/`registro'.txt") clear
	
	qui save `base', replace // Salva o TR na tempfile destinada a ele
}

end

program pofsel_17
syntax, id(string) sel(string) trs(string) temps(string) original(string) [english]

/* Criando locais para cada item de consumo e seus códigos */
	// Cada local `item' tem como primeiro elemento o identificados da variável a ser usado como nome
	// em seguida vem a numlist de todos os códigos que correspondem a ele
	
* Obs: Os códigos para a definição dos locals foi gerado a partir do arquivo leitura_tradutores.do, que usa os arquivos de tradutores do IBGE.	

if "`sel'" == "Todos" local sel Variação_Patrimonial Rendimento_Total Transferência Rendimento_do_Trabalho Rendimento_de_aluguel Outras_rendas Programas_sociais_federais Pensão_aliment_mesada_ou_doação Outras_Transferências Aposentadoria_pensão_prev_pub Aposentadoria_pensão_prev_priv Aposentadoria_e_pensão_INSS Empregador Empregado Conta_propria Despesa_Total Diminuição_do_passivo Despesas_Correntes Aumento_do_ativo Prestação_de_imóvel Empréstimo Outras_despesas_correntes Despesas_de_consumo Despesas_de_Consumo Outros_investimentos Imóvel_reforma Imóvel_aquisição Serviços_bancários Previdência_privada Pensões_mesadas_e_doações Impostos Outras_outras_desp_correntes Contribuições_trabalhistas Fumo Vestuario Transporte Serviços_pessoais Recreação_e_cultura Higiene_e_cuidados_pessoais Habitacao Educacao Despesas_diversas Assistencia_a_saude Tecidos_e_armarinhos Roupa_de_mulher Roupa_de_homem Roupa_de_crianca Joias_e_bijuterias Calcados_e_apetrechos Álcool_veículo_próprio Viagens_esporadicas Transporte_Urbano Outras_transporte Manutencao_e_acessorios Gasolina_veiculo_proprio Aquisicao_de_veiculos Outras_servicos_pessoais Manicure_e_pedicure Conserto_de_artigos_pessoais Cabeleireiro Recreações_e_esportes Periódicos_livros_revistas_nãod Outras_recreacao_cultura Celular_e_acessórios Brinquedos_e_jogos Sabonete Produtos_para_cabelo Perfume Instrumentos_produt_uso_pessoal Servicos_e_taxas Mobiliario_e_artigos_do__lar Manutencao_do_lar Eletrodomesticos Consertos_de_artigos_do_lar Condominio Artigos_de_limpeza Aluguel Outros_cursos_e_atividades Outras_educacao Livros_didaticos_e_revistas_tec Cursos_superiores Cursos_regulares Artigos_escolares Serviços_profissionais Outras_despesas_diversas Jogos_e_apostas Imóveis_de_uso_ocasional Comunicação Cerimônias_e_festas Tratamento_medico_e_ambulatoria Servico_de_cirurgia Remedios Plano_seguro_saude Outras_assistencia_saude Material_de_tratamento Hospitalizacao Exames_diversos Consulta_medica Consulta_e_tratamento_dentario Telefone_fixo Telefone_celular Pacote_de_telefone_tv_internet Outros_servicos_e_taxas Gas_domestico Energia_eletrica Agua_e_esgoto Aluguel_não_monetario Aluguel_monetario Alimentação Alimentação_no_domicílio Alimentação_fora_do_domicílio Óleos_e_gorduras Tubérculos_e_raízes Sal_e_condimentos Panificados Outros_alimentacao_no_Dom Leites_e_derivados Legumes_e_verduras Frutas Farinhas_féculas_e_massas Enlatados_e_conservas Cereais_leguminosas_oleaginosas Carnes_vísceras_e_pescados Bebidas_e_infusões Açúcares_e_derivados Acucar_Light_e_Diet Aves_e_ovos Alimentos_preparados Sanduíches_e_salgados Refrigerantes_e_outras_nãoalcoo Outras_alimentacao_fora_Dom Lanches Cervejas_chopes_outras_alcool Café_leite_caféleite_chocolate Almoço_e_jantar Alimentação_light_e_diet Óleo_de_soja Outros_oleos_gorduras Azeite_de_oliva Outros_tuberculos_raizes Mandioca Cenoura Batata_inglesa Sal_refinado Outros_sal_condimentos Massa_de_tomate Maionese Pão_francês Outros_panificados Paes_Light_e_diet Biscoito Queijos Outros_leites_derivados Leites_derivados_Orgânicos Leite_Light_e_Diet Leite_em_pó Leite_de_vaca Tomate Outros_legumes_verduras Cebola Alface Outras_frutas Maçã Laranja Banana Outras_farinhas_fec_massas Macarrão Farinha_de_trigo Farinha_de_mandioca Outros_cereais_leg_oleag Feijão Arroz Cereais_Orgânicos Pescados_frescos Outros_carnes_visc_pescados Carnes_peixes_industrializados Carne_de_suíno Carne_de_boi_de_segunda Carne_de_boi_de_primeira Refrigerantes Outras_bebidas_alcoólicas Outras_Bebidas_Infusoes Cervejas_e_chopes Café_moído Bebidas_nãoalcoól_light_e_diet Outros_Acucares_Derivados Açúcar_refinado Açúcar_cristal Ovo_de_galinha Outros_Aves_Ovos Frango


************************************************
** Alimentação (arquivo Tradutor_Alimentação) **
************************************************

/* Nível 3 */

* Alimentação light e diet

* Alimentos preparados

* Almoço e jantar

* Aves e ovos
local Frango v_DA_1081  78001/78014 78025/78027 78032/78032 78036/78036 78038/78038 78047/78048 78062/78062 78066/78066 78068/78068 78070/78072
local Orgânicos v_DA_1083  78055/78059 78064/78065
local Outros_Aves_Ovos v_DA_1084  78015/78024 78028/78031 78034/78035 78037/78037 78039/78046 78049/78054 78060/78061 78063/78063 78067/78067 78069/78069 81011/81011 81028/81028 81030/81030 81041/81041 81049/81049 81051/81051 81055/81056 81060/81061 81081/81081
local Ovo_de_galinha v_DA_1082  78033/78033

* Açúcares e derivados
local Açúcar_cristal v_DA_1042  69002/69002 69087/69087
local Açúcar_refinado v_DA_1041  69001/69001 69086/69086
local Acucar_Light_e_Diet v_DA_1043  69070/69071 69079/69081 69091/69127 69129/69141 69150/69152 69158/69158 69160/69160
local Outros_Acucares_Derivados v_DA_1044  69003/69032 69034/69056 69058/69063 69066/69069 69072/69074 69076/69078 69082/69085 69088/69090 69142/69146 69148/69149 69153/69157 69159/69159 69161/69177 80123/80123 80127/80127 80149/80149

* Bebidas e infusões
local Bebidas_nãoalcoól_light_e_diet v_DA_1123  69128/69128 82007/82008 82015/82016 82019/82019 82040/82040 82052/82052 82074/82079 82081/82085 82087/82100 82110/82129 82134/82134 82139/82141 82145/82145 82150/82150 82152/82152 82156/82156 83044/83044
local Café_moído v_DA_1121  82025/82025 82106/82106
local Cervejas_e_chopes v_DA_1124  83001/83002 83033/83033 83043/83043 83050/83051
local Outras_Bebidas_Infusoes v_DA_1126  66017/66017 66023/66023 66026/66026 69057/69057 69064/69065 69075/69075 82020/82024 82026/82034 82036/82039 82044/82045 82047/82048 82050/82051 82053/82053 82056/82056 82059/82066 82080/82080 82086/82086 82101/82105 82107/82109 82130/82133 82135/82138 82142/82144 82146/82146 82148/82149 82151/82151 82153/82154 82157/82167 82177/82183 82189/82195 82199/82200 82210/82211
local Outras_bebidas_alcoólicas v_DA_1125  82184/82184 83003/83032 83034/83042 83045/83049 83052/83053
local Refrigerantes v_DA_1122  82001/82006 82009/82014 82017/82018 82035/82035 82041/82043 82046/82046 82049/82049 82054/82055 82057/82058 82067/82073 82147/82147 82155/82155 82185/82188 82196/82198

* Café, leite, café/leite e chocolate

* Carnes, vísceras e pescados
local Carne_de_boi_de_primeira v_DA_1071  71001/71007 71014/71014 71016/71016 71059/71059 71064/71064 71078/71078 71113/71120 71125/71128 71133/71133
local Carne_de_boi_de_segunda v_DA_1072  71008/71013 71015/71015 71017/71017 71026/71026 71108/71108 71112/71112 71122/71122
local Carne_de_suíno v_DA_1073  71033/71042 71044/71053 71060/71060 71065/71065 71068/71068 71070/71070 71075/71075 71082/71085 71097/71097 71105/71106 71121/71121 71130/71130 71134/71134 71136/71136 71138/71139 71144/71146 71148/71148
local Carnes_peixes_industrializados v_DA_1074  72004/72005 72014/72015 72024/72025 72034/72035 72044/72045 72054/72055 72064/72065 72074/72075 72084/72085 72094/72095 72104/72105 72114/72116 72124/72125 72134/72135 72144/72145 72154/72155 72164/72165 72174/72175 72184/72185 72194/72195 72204/72205 72214/72215 72224/72225 72234/72235 72244/72245 72254/72255 72264/72265 72274/72275 72284/72285 72294/72295 72304/72305 72314/72315 72324/72325 72334/72335 72344/72345 72354/72355 72364/72365 72374/72375 72384/72385 72394/72395 72404/72405 72414/72415 72424/72425 72434/72435 72444/72445 72454/72455 72464/72465 72474/72475 72484/72485 72494/72495 72504/72505 72514/72515 72524/72525 72534/72535 72544/72545 72554/72555 72564/72565 72574/72575 72584/72585 72594/72595 72604/72604 72606/72606 72614/72614 72624/72624 72634/72634 72644/72644 72664/72664 72674/72674 72684/72684 72694/72695 72704/72704 72714/72715 72724/72725 72734/72734 72744/72744 72754/72755 72805/72805 74004/74005 74014/74015 74024/74025 74034/74035 74044/74045 74054/74055 74064/74065 74074/74075 74084/74085 74094/74095 74104/74105 74114/74115 74124/74125 74134/74135 74144/74145 74154/74155 74164/74165 74174/74175 74184/74185 74194/74195 74204/74205 74214/74215 74224/74225 74234/74235 74244/74245 74254/74255 74264/74265 74274/74275 74284/74285 74294/74295 74304/74305 74314/74315 74324/74325 74334/74335 74344/74345 74354/74355 74364/74365 74374/74375 74384/74385 74394/74395 74404/74405 74414/74415 74424/74425 74434/74434 74444/74445 74454/74455 74464/74465 74474/74475 74484/74485 74494/74495 74504/74504 74514/74515 76004/76005 81001/81010 81012/81027 81029/81029 81031/81031 81036/81036 81039/81039 81042/81048 81050/81050 81052/81054 81057/81057 81062/81068 81070/81074 81078/81078 81080/81080 81082/81083
local Outros_carnes_visc_pescados v_DA_1076  71018/71025 71027/71032 71043/71043 71054/71058 71061/71063 71066/71067 71069/71069 71071/71074 71076/71077 71079/71081 71086/71096 71098/71104 71107/71107 71109/71111 71123/71124 71129/71129 71131/71132 71135/71135 71137/71137 71140/71143 71147/71147 71149/71151
local Pescados_frescos v_DA_1075  72001/72003 72011/72013 72021/72023 72031/72033 72039/72039 72041/72043 72049/72049 72051/72053 72061/72063 72071/72073 72081/72083 72091/72093 72101/72103 72111/72113 72121/72123 72131/72133 72141/72143 72149/72149 72151/72153 72161/72163 72169/72169 72171/72173 72181/72183 72191/72193 72201/72203 72207/72207 72211/72213 72221/72223 72231/72233 72241/72243 72249/72249 72251/72253 72261/72263 72271/72273 72279/72279 72281/72283 72291/72293 72301/72303 72311/72313 72321/72323 72331/72333 72341/72343 72351/72353 72361/72363 72371/72373 72381/72383 72391/72393 72399/72399 72401/72403 72411/72413 72421/72423 72431/72433 72441/72443 72451/72453 72461/72463 72471/72473 72481/72483 72491/72493 72501/72503 72511/72513 72521/72523 72531/72533 72541/72543 72551/72553 72561/72563 72571/72573 72581/72583 72591/72593 72601/72602 72611/72612 72621/72622 72631/72632 72641/72642 72651/72651 72661/72662 72671/72672 72681/72682 72691/72693 72711/72713 72721/72723 72731/72731 72741/72742 72751/72753 72761/72761 72771/72771 72781/72781 72791/72791 72802/72803 72811/72811 72821/72822 72831/72831 74001/74003 74011/74013 74021/74023 74031/74033 74041/74043 74047/74047 74049/74049 74051/74053 74061/74063 74071/74073 74081/74083 74091/74093 74101/74103 74109/74109 74111/74113 74121/74123 74131/74133 74141/74143 74151/74153 74161/74163 74171/74173 74181/74183 74191/74193 74201/74203 74211/74213 74221/74223 74227/74227 74229/74229 74231/74233 74241/74243 74251/74253 74261/74263 74271/74273 74276/74276 74281/74283 74291/74293 74301/74303 74311/74313 74321/74323 74329/74329 74331/74333 74341/74343 74349/74349 74351/74353 74361/74363 74371/74373 74381/74383 74391/74393 74401/74403 74411/74413 74421/74423 74431/74432 74441/74443 74451/74453 74461/74463 74471/74473 74481/74483 74491/74493 74501/74502 74511/74513 74519/74519 74521/74521 74531/74531 74541/74541 74551/74551 74553/74553 74561/74561 74571/74571 74581/74581 74591/74591 74601/74601 74611/74611 74621/74621 76001/76003 76007/76007 76009/76009

* Cereais, leguminosas e oleaginosas
local Arroz v_DA_1011  63001/63003 63018/63018 63033/63034 63052/63054
local Feijão v_DA_1012  63012/63017 63019/63019 63021/63026 63031/63031 63046/63046 63050/63050 63055/63056
local Cereais_Orgânicos v_DA_1013  63037/63041 63043/63045 63051/63051 66029/66029
local Outros_cereais_leg_oleag v_DA_1014  63004/63011 63020/63020 63027/63030 63032/63032 63035/63036 63042/63042 63047/63049 63057/63057 65075/65075 66001/66016 66018/66022 66024/66025 66027/66028 66030/66031 69033/69033

* Cervejas, chopes e outras bebidas alcoólicas

* Enlatados e conservas

* Farinhas, féculas e massas
local Farinha_de_mandioca v_DA_1023  65014/65014
local Farinha_de_trigo v_DA_1022  65010/65010
local Macarrão v_DA_1021  65032/65034 65048/65049 65063/65063 65069/65069 65078/65080 65090/65090 65100/65100
local Outras_farinhas_fec_massas v_DA_1024  65001/65009 65011/65013 65015/65031 65035/65047 65050/65062 65064/65068 65070/65074 65076/65077 65081/65089 65091/65099 65101/65102 69147/69147

* Frutas
local Banana v_DA_1061  68001/68011 68091/68091 68098/68098 68104/68104
local Laranja v_DA_1062  68012/68015 68017/68018 68095/68095 68097/68097
local Maçã v_DA_1063  68030/68030 68086/68086
local Outras_frutas v_DA_1064  68016/68016 68019/68029 68031/68085 68087/68090 68092/68094 68096/68096 68099/68103 68105/68122

* Lanches

* Legumes e verduras
local Alface v_DA_1053  67001/67001 67078/67078
local Cebola v_DA_1052  67057/67057 67130/67130
local Outros_legumes_verduras v_DA_1054  67002/67050 67052/67056 67058/67061 67063/67077 67080/67082 67084/67091 67093/67093 67096/67096 67098/67129 67131/67131 67133/67147
local Tomate v_DA_1051  67051/67051 67079/67079

* Leites e derivados
local Leite_de_vaca v_DA_1091  79001/79002 79031/79031 79036/79038
local Leite_em_pó v_DA_1092  79006/79008 79070/79070 79117/79117 79122/79122
local Leite_Light_e_Diet v_DA_1094  79039/79042 79051/79069 79071/79072 79076/79077 79080/79080 79086/79087 79089/79089 79091/79097 79103/79105 79107/79108 79111/79111 79114/79116 79118/79118
local Leites_derivados_Orgânicos v_DA_1095  79043/79050 79073/79074
local Outros_leites_derivados v_DA_1096  79003/79005 79009/79016 79023/79023 79032/79032 79035/79035 79075/79075 79085/79085 79088/79088 79119/79121 79123/79123 79125/79125 84045/84045
local Queijos v_DA_1093  79017/79022 79024/79030 79033/79034 79078/79079 79081/79084 79090/79090 79098/79102 79106/79106 79109/79110 79112/79113 79124/79124

* Outras

* Outros

* Panificados
local Biscoito v_DA_1102  80022/80024 80048/80049 80052/80054 80118/80118 80125/80125 80128/80128 80139/80141
local Paes_Light_e_diet v_DA_1103  80065/80105 80108/80109 80112/80115 80117/80117 80136/80138 80142/80142 80144/80145 80147/80148 80150/80151 80153/80153
local Outros_panificados v_DA_1104  80002/80021 80025/80047 80050/80051 80055/80064 80106/80107 80110/80111 80119/80122 80124/80124 80129/80135 80143/80143 80146/80146 80152/80152
local Pão_francês v_DA_1101  80001/80001 80116/80116

* Refrigerantes e outras bebidas não alcoólicas

* Sal e condimentos
local Maionese v_DA_1142  70043/70043 70104/70104
local Massa_de_tomate v_DA_1141  70047/70047
local Outros_sal_condimentos v_DA_1144  67062/67062 67083/67083 67092/67092 67094/67095 67097/67097 70002/70042 70044/70046 70048/70103 70105/70109 70111/70151
local Sal_refinado v_DA_1143  70001/70001 70110/70110

* Sanduíches e salgados

* Tubérculos e raízes
local Batata_inglesa v_DA_1031  64001/64001 64018/64018
local Cenoura v_DA_1032  64012/64012 64019/64019
local Mandioca v_DA_1033  64006/64006 64023/64024
local Outros_tuberculos_raizes v_DA_1034  64002/64005 64007/64011 64013/64017 64020/64020 64022/64022 64025/64027

* Óleos e gorduras
local Azeite_de_oliva v_DA_1112  84001/84001
local Outros_oleos_gorduras v_DA_1113  84002/84002 84004/84044
local Óleo_de_soja v_DA_1111  84003/84003

/* Nível 2 */

* Alimentação fora do domicílio
local Alimentação_light_e_diet v_DA_207  24013/24013 24022/24022 24024/24024 24059/24068 24070/24070 24072/24072 24074/24074 24078/24089 24091/24095 24107/24107
local Almoço_e_jantar v_DA_201  24001/24004 24049/24051 24056/24057 24096/24096 41001/41001 48018/48018
local Café_leite_caféleite_chocolate v_DA_202  24017/24018 24034/24034 24044/24045 24071/24071 24073/24073 24115/24115
local Cervejas_chopes_outras_alcool v_DA_206  24026/24029 24035/24038 24075/24076 24101/24101 24111/24113 24116/24116 24118/24118 24125/24126
local Lanches v_DA_205  24058/24058
local Outras_alimentacao_fora_Dom v_DA_208  24005/24005 24008/24012 24014/24016 24039/24039 24054/24054 24077/24077 24097/24097 24099/24100 24106/24106 24110/24110 24117/24117 24120/24121 24124/24124 24127/24127 24999/24999 49075/49075 49089/49089
local Refrigerantes_e_outras_nãoalcoo v_DA_204  24019/24021 24023/24023 24025/24025 24030/24033 24040/24043 24046/24048 24052/24053 24055/24055 24069/24069 24098/24098 24102/24105 24108/24109 24114/24114 24119/24119 24122/24123 24128/24128
local Sanduíches_e_salgados v_DA_203  24006/24007 24090/24090

* Alimentação no domicílio
local Alimentos_preparados v_DA_115  64028/64028 80126/80126 81069/81069 81079/81079 81084/81084 85001/85092 85094/85119
local Aves_e_ovos v_DA_108  78001/78072 81011/81011 81028/81028 81030/81030 81041/81041 81049/81049 81051/81051 81055/81056 81060/81061 81081/81081
local Açúcares_e_derivados v_DA_104  69001/69032 69034/69056 69058/69063 69066/69074 69076/69127 69129/69146 69148/69177 80123/80123 80127/80127 80149/80149
local Bebidas_e_infusões v_DA_112  66017/66017 66023/66023 66026/66026 69057/69057 69064/69065 69075/69075 69128/69128 82001/82167 82177/82200 82210/82211 83001/83053
local Carnes_vísceras_e_pescados v_DA_107  71001/71151 72001/72005 72011/72015 72021/72025 72031/72035 72039/72039 72041/72045 72049/72049 72051/72055 72061/72065 72071/72075 72081/72085 72091/72095 72101/72105 72111/72116 72121/72125 72131/72135 72141/72145 72149/72149 72151/72155 72161/72165 72169/72169 72171/72175 72181/72185 72191/72195 72201/72205 72207/72207 72211/72215 72221/72225 72231/72235 72241/72245 72249/72249 72251/72255 72261/72265 72271/72275 72279/72279 72281/72285 72291/72295 72301/72305 72311/72315 72321/72325 72331/72335 72341/72345 72351/72355 72361/72365 72371/72375 72381/72385 72391/72395 72399/72399 72401/72405 72411/72415 72421/72425 72431/72435 72441/72445 72451/72455 72461/72465 72471/72475 72481/72485 72491/72495 72501/72505 72511/72515 72521/72525 72531/72535 72541/72545 72551/72555 72561/72565 72571/72575 72581/72585 72591/72595 72601/72602 72604/72604 72606/72606 72611/72612 72614/72614 72621/72622 72624/72624 72631/72632 72634/72634 72641/72642 72644/72644 72651/72651 72661/72662 72664/72664 72671/72672 72674/72674 72681/72682 72684/72684 72691/72695 72704/72704 72711/72715 72721/72725 72731/72731 72734/72734 72741/72742 72744/72744 72751/72755 72761/72761 72771/72771 72781/72781 72791/72791 72802/72803 72805/72805 72811/72811 72821/72822 72831/72831 74001/74005 74011/74015 74021/74025 74031/74035 74041/74045 74047/74047 74049/74049 74051/74055 74061/74065 74071/74075 74081/74085 74091/74095 74101/74105 74109/74109 74111/74115 74121/74125 74131/74135 74141/74145 74151/74155 74161/74165 74171/74175 74181/74185 74191/74195 74201/74205 74211/74215 74221/74225 74227/74227 74229/74229 74231/74235 74241/74245 74251/74255 74261/74265 74271/74276 74281/74285 74291/74295 74301/74305 74311/74315 74321/74325 74329/74329 74331/74335 74341/74345 74349/74349 74351/74355 74361/74365 74371/74375 74381/74385 74391/74395 74401/74405 74411/74415 74421/74425 74431/74432 74434/74434 74441/74445 74451/74455 74461/74465 74471/74475 74481/74485 74491/74495 74501/74502 74504/74504 74511/74515 74519/74519 74521/74521 74531/74531 74541/74541 74551/74551 74553/74553 74561/74561 74571/74571 74581/74581 74591/74591 74601/74601 74611/74611 74621/74621 76001/76005 76007/76007 76009/76009 81001/81010 81012/81027 81029/81029 81031/81031 81036/81036 81039/81039 81042/81048 81050/81050 81052/81054 81057/81057 81062/81068 81070/81074 81078/81078 81080/81080 81082/81083
local Cereais_leguminosas_oleaginosas v_DA_101  63001/63057 65075/65075 66001/66016 66018/66022 66024/66025 66027/66031 69033/69033
local Enlatados_e_conservas v_DA_113  77001/77088 81032/81035 81037/81038 81040/81040 81058/81059 81075/81077
local Farinhas_féculas_e_massas v_DA_102  65001/65074 65076/65102 69147/69147
local Frutas v_DA_106  68001/68122
local Legumes_e_verduras v_DA_105  67001/67061 67063/67082 67084/67091 67093/67093 67096/67096 67098/67131 67133/67147
local Leites_e_derivados v_DA_109  79001/79125 84045/84045
local Outros_alimentacao_no_Dom v_DA_116  90001/90009
local Panificados v_DA_110  80001/80122 80124/80125 80128/80148 80150/80153
local Sal_e_condimentos v_DA_114  67062/67062 67083/67083 67092/67092 67094/67095 67097/67097 70001/70151
local Tubérculos_e_raízes v_DA_103  64001/64020 64022/64027
local Óleos_e_gorduras v_DA_111  84001/84044

/* Nível 1 */

* Alimentacao
local Alimentação_fora_do_domicílio v_DA_2  24001/24128 24999/24999 41001/41001 48018/48018 49075/49075 49089/49089
local Alimentação_no_domicílio v_DA_1  63001/63057 64001/64020 64022/64028 65001/65102 66001/66031 67001/67131 67133/67147 68001/68122 69001/69177 70001/70151 71001/71151 72001/72005 72011/72015 72021/72025 72031/72035 72039/72039 72041/72045 72049/72049 72051/72055 72061/72065 72071/72075 72081/72085 72091/72095 72101/72105 72111/72116 72121/72125 72131/72135 72141/72145 72149/72149 72151/72155 72161/72165 72169/72169 72171/72175 72181/72185 72191/72195 72201/72205 72207/72207 72211/72215 72221/72225 72231/72235 72241/72245 72249/72249 72251/72255 72261/72265 72271/72275 72279/72279 72281/72285 72291/72295 72301/72305 72311/72315 72321/72325 72331/72335 72341/72345 72351/72355 72361/72365 72371/72375 72381/72385 72391/72395 72399/72399 72401/72405 72411/72415 72421/72425 72431/72435 72441/72445 72451/72455 72461/72465 72471/72475 72481/72485 72491/72495 72501/72505 72511/72515 72521/72525 72531/72535 72541/72545 72551/72555 72561/72565 72571/72575 72581/72585 72591/72595 72601/72602 72604/72604 72606/72606 72611/72612 72614/72614 72621/72622 72624/72624 72631/72632 72634/72634 72641/72642 72644/72644 72651/72651 72661/72662 72664/72664 72671/72672 72674/72674 72681/72682 72684/72684 72691/72695 72704/72704 72711/72715 72721/72725 72731/72731 72734/72734 72741/72742 72744/72744 72751/72755 72761/72761 72771/72771 72781/72781 72791/72791 72802/72803 72805/72805 72811/72811 72821/72822 72831/72831 74001/74005 74011/74015 74021/74025 74031/74035 74041/74045 74047/74047 74049/74049 74051/74055 74061/74065 74071/74075 74081/74085 74091/74095 74101/74105 74109/74109 74111/74115 74121/74125 74131/74135 74141/74145 74151/74155 74161/74165 74171/74175 74181/74185 74191/74195 74201/74205 74211/74215 74221/74225 74227/74227 74229/74229 74231/74235 74241/74245 74251/74255 74261/74265 74271/74276 74281/74285 74291/74295 74301/74305 74311/74315 74321/74325 74329/74329 74331/74335 74341/74345 74349/74349 74351/74355 74361/74365 74371/74375 74381/74385 74391/74395 74401/74405 74411/74415 74421/74425 74431/74432 74434/74434 74441/74445 74451/74455 74461/74465 74471/74475 74481/74485 74491/74495 74501/74502 74504/74504 74511/74515 74519/74519 74521/74521 74531/74531 74541/74541 74551/74551 74553/74553 74561/74561 74571/74571 74581/74581 74591/74591 74601/74601 74611/74611 74621/74621 76001/76005 76007/76007 76009/76009 77001/77088 78001/78072 79001/79125 80001/80153 81001/81084 82001/82167 82177/82200 82210/82211 83001/83053 84001/84045 85001/85092 85094/85119 90001/90009

/* Nível 0 */
local Alimentação v_DA_0  24001/24128 24999/24999 41001/41001 48018/48018 49075/49075 49089/49089 63001/63057 64001/64020 64022/64028 65001/65102 66001/66031 67001/67131 67133/67147 68001/68122 69001/69177 70001/70151 71001/71151 72001/72005 72011/72015 72021/72025 72031/72035 72039/72039 72041/72045 72049/72049 72051/72055 72061/72065 72071/72075 72081/72085 72091/72095 72101/72105 72111/72116 72121/72125 72131/72135 72141/72145 72149/72149 72151/72155 72161/72165 72169/72169 72171/72175 72181/72185 72191/72195 72201/72205 72207/72207 72211/72215 72221/72225 72231/72235 72241/72245 72249/72249 72251/72255 72261/72265 72271/72275 72279/72279 72281/72285 72291/72295 72301/72305 72311/72315 72321/72325 72331/72335 72341/72345 72351/72355 72361/72365 72371/72375 72381/72385 72391/72395 72399/72399 72401/72405 72411/72415 72421/72425 72431/72435 72441/72445 72451/72455 72461/72465 72471/72475 72481/72485 72491/72495 72501/72505 72511/72515 72521/72525 72531/72535 72541/72545 72551/72555 72561/72565 72571/72575 72581/72585 72591/72595 72601/72602 72604/72604 72606/72606 72611/72612 72614/72614 72621/72622 72624/72624 72631/72632 72634/72634 72641/72642 72644/72644 72651/72651 72661/72662 72664/72664 72671/72672 72674/72674 72681/72682 72684/72684 72691/72695 72704/72704 72711/72715 72721/72725 72731/72731 72734/72734 72741/72742 72744/72744 72751/72755 72761/72761 72771/72771 72781/72781 72791/72791 72802/72803 72805/72805 72811/72811 72821/72822 72831/72831 74001/74005 74011/74015 74021/74025 74031/74035 74041/74045 74047/74047 74049/74049 74051/74055 74061/74065 74071/74075 74081/74085 74091/74095 74101/74105 74109/74109 74111/74115 74121/74125 74131/74135 74141/74145 74151/74155 74161/74165 74171/74175 74181/74185 74191/74195 74201/74205 74211/74215 74221/74225 74227/74227 74229/74229 74231/74235 74241/74245 74251/74255 74261/74265 74271/74276 74281/74285 74291/74295 74301/74305 74311/74315 74321/74325 74329/74329 74331/74335 74341/74345 74349/74349 74351/74355 74361/74365 74371/74375 74381/74385 74391/74395 74401/74405 74411/74415 74421/74425 74431/74432 74434/74434 74441/74445 74451/74455 74461/74465 74471/74475 74481/74485 74491/74495 74501/74502 74504/74504 74511/74515 74519/74519 74521/74521 74531/74531 74541/74541 74551/74551 74553/74553 74561/74561 74571/74571 74581/74581 74591/74591 74601/74601 74611/74611 74621/74621 76001/76005 76007/76007 76009/76009 77001/77088 78001/78072 79001/79125 80001/80153 81001/81084 82001/82167 82177/82200 82210/82211 83001/83053 84001/84045 85001/85092 85094/85119 90001/90009


******************************************************
** Despesas Totais (Arquivo Tradutor Despesa Geral) **
******************************************************

/* Nível 5 */

* Aluguel
local Aluguel_monetario v_DT_1102011  10001/10002 10004/10004 10009/10009
local Aluguel_não_monetario v_DT_1102012  1/1

* Aquisicao de veiculos

* Artigos de limpeza

* Artigos escolares

* Brinquedos e jogos

* Cabeleireiro

* Calcados e apetrechos

* Carimonia e festas

* Celular e acessórios

* Cerimônias e festas

* Comunicação

* Condominio

* Conserto de artigos pessoais

* Consertos de artigos do lar

* Consulta e tratamento dentario

* Consulta medica

* Cursos regulares

* Cursos superiores

* Eletrodomesticos

* Exames diversos

* Gasolina - veiculo proprio

* Hospitalizacao

* Imóveis de uso ocasional

* Instrumentos e produtos de uso pessoal

* Jogos e apostas

* Joias  e bijuterias

* Livros didaticos e revistas tecnicas

* Manicure e pedicure

* Manutencao do lar

* Manutencao e acessorios

* Material de tratamento

* Mobiliario e artigos do  lar

* Outras

* Outros cursos e atividades

* Perfume

* Periódicos, livros e revistas não didáticos

* Plano seguro saude

* Produtos para cabelo

* Recreações e esportes

* Remedios

* Roupa de crianca

* Roupa de homem

* Roupa de mulher

* Sabonete

* Servico de cirurgia

* Servicos e taxas
local Agua_e_esgoto v_DT_1102036  6002/6002 6018/6018 12017/12017 12027/12027
local Energia_eletrica v_DT_1102031  6001/6001
local Gas_domestico v_DT_1102035  6003/6003 7001/7001
local Outros_servicos_e_taxas v_DT_1102037  6005/6006 6999/6999 10999/10999 12003/12003 12005/12012 12014/12016 12018/12026 12028/12030 12032/12034 12036/12036 12999/12999
local Pacote_de_telefone_tv_internet v_DT_1102034  6007/6017 28030/28030
local Telefone_celular v_DT_1102033  44001/44003 44007/44007
local Telefone_fixo v_DT_1102032  6004/6004

* Serviços profissionais

* Tecidos e armarinhos

* Tratamento medico e ambulatorial

* Urbano

* Viagens esporadicas

* Álcool – veículo próprio

/* Nível 4 */

* Assistencia a saude
local Consulta_e_tratamento_dentario v_DT_110603  42012/42012 42031/42031
local Consulta_medica v_DT_110604  42005/42011 42034/42051 42084/42088 42090/42091 42093/42094 42098/42098 42100/42100 42102/42102
local Exames_diversos v_DT_110608  42017/42023 42061/42070 42075/42076 42083/42083 42095/42095 42097/42097 42099/42099 42101/42101 42103/42103
local Hospitalizacao v_DT_110607  42027/42027
local Material_de_tratamento v_DT_110609  29027/29032 29034/29035 29038/29042 29058/29058 29083/29083 30034/30034 42028/42030 42032/42032 42052/42055 42078/42078
local Outras_assistencia_saude v_DT_110610  29033/29033 29036/29036 29068/29068 42025/42025 42033/42033 42071/42071 42074/42074 42079/42080 42082/42082 42092/42092 42104/42104 42999/42999
local Plano_seguro_saude v_DT_110602  42001/42004 42056/42056
local Remedios v_DT_110601  29001/29026 29043/29057 29059/29067 29069/29082 29084/29086 29088/29089 29999/29999
local Servico_de_cirurgia v_DT_110606  42026/42026
local Tratamento_medico_e_ambulatoria v_DT_110605  42013/42016 42024/42024 42057/42060 42072/42073 42077/42077 42081/42081 42089/42089 42096/42096

* Contribuições trabalhistas

* Despesas diversas
local Cerimônias_e_festas v_DT_111103 11078/11078 45001/45019 45026/45030 45999/45999
local Comunicação v_DT_111102  25001/25004 25999/25999
local Imóveis_de_uso_ocasional v_DT_111105  41019/41019 47003/47005 47008/47019 47022/47025 47028/47029 47999/47999
local Jogos_e_apostas v_DT_111101  22001/22032 22999/22999
local Outras_despesas_diversas v_DT_111106  9014/9016 9019/9019 9101/9108 12004/12004 13001/13009 13999/13999 16011/16011 25005/25005 30023/30023 31020/31022 32010/32010 32015/32016 32019/32021 32033/32033 32038/32044 32047/32054 32065/32065 32070/32071 32079/32080 32086/32086 38042/38043 38053/38053 39016/39016 39019/39019 40999/40999 41059/41061 43020/43021 43048/43049 87001/87014 87016/87016 87018/87021 88001/88002
local Serviços_profissionais v_DT_111104  40001/40016 40018/40019

* Educacao
local Artigos_escolares v_DT_110705  32001/32009 32011/32014 32023/32032 32034/32034 32036/32037 32045/32046 32055/32056 32058/32058 32060/32062 32066/32069 32072/32072 32074/32078 32082/32082 32084/32085 32999/32999 38044/38045
local Cursos_regulares v_DT_110701  49002/49003 49005/49005
local Cursos_superiores v_DT_110702  49008/49009
local Livros_didaticos_e_revistas_tec v_DT_110704  49030/49033 49076/49076
local Outras_educacao v_DT_110706  32022/32022 48013/48013 48016/48016 49029/49029 49034/49039 49077/49077 49082/49084 49086/49088 49095/49095 49123/49123 49999/49999
local Outros_cursos_e_atividades v_DT_110703  49001/49001 49004/49004 49006/49007 49010/49028 49040/49074 49078/49081 49085/49085 49090/49094 49096/49122 49124/49132

* Fumo

* Habitacao
local Aluguel v_DT_110201  1/2 4/4 9/10 100/100 1000/1000 10001/10002 10004/10004 10009/10009
local Artigos_de_limpeza v_DT_110205  8020/8022 8050/8051 8058/8058 8600/8610 9011/9012 9094/9094 39011/39012 39094/39094 86001/86003 86007/86008 86011/86011 86014/86026 86030/86034 86042/86042 86045/86045 86056/86056 86058/86058 86061/86061 86063/86066 86069/86071 86075/86075 86077/86077 86086/86086 86089/86089 86093/86093 86095/86095 86097/86097 86100/86100 86102/86102
local Condominio v_DT_110202  10005/10005 10010/10010
local Consertos_de_artigos_do_lar v_DT_110208  9001/9013 9017/9100 9109/9226 9999/9999 31046/31046
local Eletrodomesticos v_DT_110207  15001/15077 15079/15092 15095/15097 15099/15106 15108/15110 15112/15124 15999/15999 16001/16001 16007/16008 16016/16018 16025/16026 16029/16029 16035/16035 39021/39021 39028/39028 43002/43002 43046/43047
local Manutencao_do_lar v_DT_110204  7002/7011 7999/7999 8001/8019 8023/8049 8052/8057 8059/8060 8062/8068 8605/8605 8607/8607 8999/8999 9001/9017 9999/9999 19001/19017 19999/19999 86057/86057 86073/86073
local Mobiliario_e_artigos_do__lar v_DT_110206  8061/8061 8601/8610 8999/8999 9001/9010 9013/9015 9017/9018 9020/9020 9022/9027 9029/9034 9037/9037 9039/9093 9095/9233 9999/9999 15078/15078 15094/15094 15107/15107 15111/15111 16002/16002 16004/16006 16009/16010 16012/16015 16019/16024 16027/16028 16030/16034 16036/16039 16041/16041 16999/16999 17001/17084 17086/17111 17113/17113 17999/17999 18001/18045 18999/18999 32035/32035 32059/32059 32063/32063 32081/32081 32083/32083 37009/37012 39001/39010 39013/39015 39017/39018 39020/39020 39022/39027 39029/39034 39037/39037 39039/39093 39095/39233 39999/39999 86012/86013 86028/86029 86035/86036 86039/86041 86043/86044 86046/86046 86048/86050 86052/86054 86062/86062 86067/86068 86072/86072 86074/86074 86076/86076 86078/86081 86085/86085 86091/86091 86099/86099 86101/86101 86103/86104
local Servicos_e_taxas v_DT_110203  6001/6018 6999/6999 7001/7001 10999/10999 12003/12003 12005/12012 12014/12030 12032/12034 12036/12036 12999/12999 28030/28030 44001/44003 44007/44007 

* Higiene e cuidados pessoais
local Instrumentos_produt_uso_pessoal v_DT_110504  29037/29037 30002/30002 30004/30010 30012/30022 30024/30033 30035/30036 30999/30999 38022/38022 38034/38034 39036/39036 39038/39038 43045/43045 43057/43057 89001/89001
local Perfume v_DT_110501  30001/30001
local Produtos_para_cabelo v_DT_110502  30011/30011
local Sabonete v_DT_110503  30003/30003

* Impostos

* Outras

* Pensões, mesadas e doações

* Previdência privada

* Recreação e cultura
local Brinquedos_e_jogos v_DT_110801  28028/28028 43001/43001 43053/43053
local Celular_e_acessórios v_DT_110802  44004/44006 44008/44009 44999/44999
local Outras_recreacao_cultura v_DT_110805  16003/16003 27011/27011 27027/27027 28019/28027 28029/28029 28031/28039 28059/28059 28061/28061 28069/28070 28077/28077 28079/28080 28999/28999 37018/37022 37024/37024 39035/39035 41017/41017 41062/41062 43003/43019 43022/43044 43050/43052 43054/43056 43999/43999 51010/51010 51014/51014
local Periódicos_livros_revistas_nãod v_DT_110803  27001/27010 27012/27026 27028/27028 27999/27999 32017/32018 32057/32057
local Recreações_e_esportes v_DT_110804  28001/28018 28040/28054 28056/28058 28062/28068 28071/28076 28078/28078 28081/28083 34026/34026 35023/35023 36035/36035 38041/38041 41020/41026 41044/41057 41065/41067 41069/41069 41071/41072 45020/45025 47021/47021

* Serviços bancários

* Serviços pessoais
local Cabeleireiro v_DT_111001  31001/31004
local Conserto_de_artigos_pessoais v_DT_111003  31014/31014 31018/31019 31027/31028 31035/31038 31042/31044
local Manicure_e_pedicure v_DT_111002  31005/31005
local Outras_servicos_pessoais v_DT_111004  28060/28060 31006/31013 31015/31017 31023/31026 31029/31034 31039/31041 31045/31045 31999/31999

* Transporte
local Aquisicao_de_veiculos v_DT_110405  50015/50015 51001/51009 51011/51013 51015/51025 51999/51999
local Gasolina_veiculo_proprio v_DT_110402  23014/23015
local Manutencao_e_acessorios v_DT_110404  23021/23021 33001/33067 33999/33999
local Outras_transporte v_DT_110407  23010/23010 23017/23020 23022/23022 50002/50003 50009/50013 50999/50999
local Transporte_Urbano v_DT_110401  23001/23009 23011/23013 23023/23032 23999/23999 48028/48028
local Viagens_esporadicas v_DT_110406  41002/41016 41018/41018 41027/41043 41058/41058 41063/41064 41068/41068 41999/41999
local Álcool_veículo_próprio v_DT_110403  23016/23016

* Vestuario
local Calcados_e_apetrechos v_DT_110304  38001/38020 38023/38033 38035/38036 38039/38040 38046/38049 38051/38052 38999/38999
local Joias_e_bijuterias v_DT_110305  38021/38021 38050/38050 38055/38055 46001/46007 46999/46999
local Roupa_de_crianca v_DT_110303  36001/36034 36036/36054 36999/36999 37017/37017
local Roupa_de_homem v_DT_110301  34001/34025 34027/34030 34999/34999
local Roupa_de_mulher v_DT_110302  35001/35022 35024/35047 35999/35999
local Tecidos_e_armarinhos v_DT_110306  37001/37008 37013/37016 37023/37023 37999/37999 38054/38054

/* Nível 3 */

* Despesas de Consumo
local Assistencia_a_saude v_DT_1106  29001/29036 29038/29086 29088/29089 29999/29999 30034/30034 42001/42104 42999/42999
local Despesas_diversas v_DT_1111  9014/9016 9019/9019 9101/9108 12004/12004 13001/13009 13999/13999 16011/16011 22001/22032 22999/22999 25001/25004 25999/25999 30023/30023 31020/31022 32010/32010 32015/32016 32019/32021 32033/32033 32038/32044 32047/32054 32065/32065 32070/32071 32079/32080 32086/32086 38042/38043 38053/38053 39016/39016 39019/39019 40001/40016 40018/40019 40999/40999 41019/41019 41059/41061 43020/43021 43048/43049 45001/45019 45026/45030 45999/45999 47003/47005 47008/47019 47022/47025 47028/47029 47999/47999 87001/87014 87016/87016 87018/87021 88001/88002 11078/11078 25005/25005
local Educacao v_DT_1107  32001/32009 32011/32014 32022/32032 32034/32034 32036/32037 32045/32046 32055/32056 32058/32058 32060/32062 32066/32069 32072/32072 32074/32078 32082/32082 32084/32085 32999/32999 38044/38045 48013/48013 48016/48016 49001/49074 49076/49088 49090/49132 49999/49999
local Habitacao v_DT_1102  1/233 280/280 299/300 304/304 310/310 320/320 370/370 390/392 399/400 430/430 440/440 500/512 599/610 699/711 799/806 860/861 899/923 999/1001 1046/1046 1099/1099 1200/1203 1299/1299 1500/1512 1599/1604 1699/1711 1799/1804 1899/1901 1999/1999 2003/2003 2005/2012 2014/2030 2032/2036 2059/2059 2063/2063 2081/2081 2083/2083 2803/2803 2999/2999 3002/3002 3046/3047 3104/3104 3203/3203 3205/3206 3208/3208 3700/3701 3900/3923 3999/3999 4001/4003 4007/4007 4300/4300 4304/4304 4400/4400 5001/5092 5094/5097 5099/5124 5999/5999 6001/6046 6048/6050 6052/6054 6056/6058 6061/6081 6085/6086 6089/6089 6091/6091 6093/6093 6095/6095 6097/6097 6099/6104 6999/6999 7001/7084 7086/7111 7113/7113 7999/7999 8001/8068 8600/8610 8999/8999 9001/9233 9999/9999 10001/10002 10004/10005 10009/10010 10999/10999 12003/12003 12005/12012 12014/12030 12032/12034 12036/12036 12999/12999 15001/15092 15094/15097 15099/15124 15999/15999 16001/16002 16004/16010 16012/16039 16041/16041 16999/16999 17001/17084 17086/17111 17113/17113 17999/17999 18001/18045 18999/18999 19001/19017 19999/19999 28030/28030 31046/31046 32035/32035 32059/32059 32063/32063 32081/32081 32083/32083 37009/37012 39001/39015 39017/39018 39020/39034 39037/39037 39039/39233 39999/39999 43002/43002 43046/43047 44001/44003 44007/44007 86001/86003 86007/86008 86011/86026 86028/86036 86039/86046 86048/86050 86052/86054 86056/86058 86061/86081 86085/86086 86089/86089 86091/86091 86093/86093 86095/86095 86097/86097 86099/86104
local Higiene_e_cuidados_pessoais v_DT_1105  29037/29037 30001/30022 30024/30033 30035/30036 30999/30999 38022/38022 38034/38034 39036/39036 39038/39038 43045/43045 43057/43057 89001/89001
local Recreação_e_cultura v_DT_1108  16003/16003 27001/27028 27999/27999 28001/28029 28031/28054 28056/28059 28061/28083 32017/32018 32057/32057 37018/37022 37024/37024 38041/38041 39035/39035 41020/41026 41044/41057 41065/41067 41069/41069 41071/41072 43001/43001 43003/43019 43022/43044 43050/43056 43999/43999 44004/44006 44008/44009 44999/44999 45020/45025 47021/47021 51010/51010 51014/51014 28999/28999 34026/34026 35023/35023 36035/36035 41017/41017 41062/41062
local Serviços_pessoais v_DT_1110  28060/28060 31015/31015 31001/31014 31016/31019 31023/31045 31999/31999
local Transporte v_DT_1104  23001/23032 23999/23999 33001/33067 33999/33999 41002/41016 41018/41018 41027/41043 41058/41058 41063/41064 41068/41068 41999/41999 48028/48028 50002/50003 50009/50013 50015/50015 50999/50999 51001/51009 51011/51013 51015/51025 51999/51999
local Vestuario v_DT_1103  34001/34025 34027/34030 34999/34999 35001/35022 35024/35047 35999/35999 36001/36034 36036/36054 36999/36999 37001/37008 37013/37017 37023/37023 37999/37999 38001/38021 38023/38033 38035/38036 38039/38040 38046/38052 38054/38055 38999/38999 46001/46007 46999/46999
local Fumo v_DT_1109  21001/21025 21999/21999 38037/38038

* Empréstimo

* Imóvel (aquisição)

* Imóvel (reforma)

* Outras despesas correntes
local Contribuições_trabalhistas v_DT_1202  19001/19017 19999/19999 48005/48005 48010/48011 53001/53006
local Impostos v_DT_1201  10006/10007 10011/10016 12035/12035 47006/47007 47026/47026 48004/48004 48031/48031 48037/48037 50001/50001 50004/50006 50008/50008 50014/50014 50016/50017 53001/53006
local Outras_outras_desp_correntes v_DT_1206  12013/12013 12031/12031 40017/40017 48007/48008 48015/48015 48019/48021 48023/48023 48029/48029 48035/48036 48999/48999 50007/50007 54001/54035 55001/55067
local Pensões_mesadas_e_doações v_DT_1204  48009/48009 48012/48012 48014/48014 48017/48017 48025/48025 48027/48027 48030/48030 48032/48032 48034/48034
local Previdência_privada v_DT_1205  48006/48006
local Serviços_bancários v_DT_1203  26001/26015 26999/26999

* Outros investimentos

* Prestação de imóvel

/* Nível 2 */

* Aumento do ativo
local Imóvel_aquisição v_DT_21  12001/12002 47001/47002 47027/47027
local Imóvel_reforma v_DT_22  11001/11077 11079/11080 11082/11104 11999/11999
local Outros_investimentos v_DT_23  15093/15093 15098/15098 47020/47020 48026/48026 48033/48033

* Despesas Correntes
local Despesas_de_Consumo v_DT_11  1/233 239/239 250/250 280/280 289/290 299/306 309/310 320/320 329/330 339/340 349/350 359/360 369/370 379/380 389/392 399/403 410/410 419/421 429/430 440/440 460/460 469/469 480/480 490/491 499/512 519/519 599/610 699/711 799/806 860/861 890/890 899/923 999/1025 1027/1043 1046/1046 1058/1058 1062/1064 1068/1068 1078/1078 1099/1099 1107/1107 1200/1203 1299/1299 1500/1512 1599/1604 1699/1711 1799/1804 1899/1901 1999/1999 2001/2104 2300/2303 2399/2399 2500/2500 2803/2803 2806/2806 2899/2908 2999/3067 3099/3099 3101/3101 3104/3104 3200/3208 3299/3306 3399/3403 3499/3504 3599/3605 3699/3702 3799/3805 3899/3923 3999/3999 4001/4030 4100/4106 4199/4210 4299/4300 4304/4305 4400/4400 4600/4600 4699/4699 4801/4802 4900/4913 4999/5092 5094/5097 5099/5124 5199/5199 5999/5999 6001/6054 6056/6058 6061/6081 6085/6086 6089/6089 6091/6091 6093/6093 6095/6095 6097/6097 6099/6104 6999/6999 7001/7084 7086/7111 7113/7113 7999/7999 8001/8068 8600/8610 8900/8900 8999/8999 9001/9233 9999/9999 10001/10002 10004/10005 10009/10010 10999/10999 11078/11078 12003/12003 12005/12012 12014/12030 12032/12034 12036/12036 12999/12999 15001/15092 15094/15097 15099/15124 15999/15999 16001/16002 16004/16010 16012/16039 16041/16041 16999/16999 17001/17084 17086/17111 17113/17113 17999/17999 18001/18045 18999/18999 19001/19017 19999/19999 23001/23032 23999/23999 25005/25005 28030/28030 28060/28060 28999/28999 29001/29086 29088/29089 29999/29999 30001/30022 30024/30036 30999/30999 31015/31015 31046/31046 32001/32009 32011/32014 32022/32032 32034/32037 32045/32046 32055/32056 32058/32063 32066/32069 32072/32072 32074/32078 32081/32085 32999/32999 33001/33067 33999/33999 34001/34030 34999/34999 35001/35047 35999/35999 36001/36054 36999/36999 37001/37017 37023/37023 37999/37999 38001/38036 38039/38040 38044/38052 38054/38055 38999/38999 39001/39015 39017/39018 39020/39034 39036/39233 39999/39999 41002/41018 41027/41043 41058/41058 41062/41064 41068/41068 41999/41999 42001/42104 42999/42999 43002/43002 43045/43047 43057/43057 44001/44003 44007/44007 46001/46007 46999/46999 48013/48013 48016/48016 48028/48028 49001/49074 49076/49088 49090/49132 49999/49999 50002/50003 50009/50013 50015/50015 50999/50999 51001/51009 51011/51013 51015/51025 51999/51999 86001/86003 86007/86008 86011/86026 86028/86036 86039/86046 86048/86050 86052/86054 86056/86058 86061/86081 86085/86086 86089/86089 86091/86091 86093/86093 86095/86095 86097/86097 86099/86104 89001/89001
local Despesas_de_consumo v_DT_11  9014/9016 9019/9019 9035/9035 9101/9108 12004/12004 13001/13009 13999/13999 16003/16003 16011/16011 21001/21025 21999/21999 22001/22032 22999/22999 25001/25004 25999/25999 27001/27028 27999/27999 28001/28029 28031/28054 28056/28059 28061/28083 30023/30023 31001/31014 31016/31045 31999/31999 32010/32010 32015/32021 32033/32033 32038/32044 32047/32054 32057/32057 32065/32065 32070/32071 32079/32080 32086/32086 37018/37022 37024/37024 38037/38038 38041/38043 38053/38053 39016/39016 39019/39019 39035/39035 40001/40016 40018/40019 40999/40999 41019/41026 41044/41057 41059/41061 41065/41067 41069/41069 41071/41072 43001/43001 43003/43044 43048/43056 43999/43999 44004/44006 44008/44009 44999/44999 45001/45030 45999/45999 47003/47005 47008/47019 47021/47025 47028/47029 47999/47999 51010/51010 51014/51014 87001/87014 87016/87016 87018/87021 88001/88002
local Outras_despesas_correntes v_DT_12  10006/10007 10011/10016 12013/12013 12031/12031 12035/12035 19001/19017 19999/19999 26001/26015 26999/26999 40017/40017 47006/47007 47026/47026 48004/48012 48014/48015 48017/48017 48019/48021 48023/48023 48025/48025 48027/48027 48029/48032 48034/48037 48999/48999 50001/50001 50004/50008 50014/50014 50016/50017 53001/53006 54001/54035 55001/55067

* Diminuição do passivo
local Empréstimo v_DT_31  48001/48003 48022/48022 48024/48024
local Prestação_de_imóvel v_DT_32  10003/10003 10008/10008
* Nível 1

* Despesa Total
local Aumento_do_ativo v_DT_2  11001/11077 11079/11080 11082/11104 11999/11999 12001/12002 15093/15093 15098/15098 47001/47002 47020/47020 47027/47027 48026/48026 48033/48033
local Despesas_Correntes v_DT_1  1/233 239/239 250/250 259/260 269/270 279/280 289/290 299/306 309/310 319/320 329/330 339/340 349/350 359/360 369/370 379/380 389/392 399/403 409/410 419/421 429/430 439/440 449/450 459/460 469/470 479/480 489/491 499/512 519/519 530/530 540/540 550/550 599/610 699/711 799/808 860/861 870/870 880/880 890/890 899/923 999/1069 1071/1072 1078/1078 1099/1099 1107/1107 1200/1203 1299/1300 1399/1399 1500/1512 1599/1604 1699/1711 1799/1804 1899/1901 1999/1999 2001/2104 2199/2203 2299/2303 2399/2399 2500/2500 2599/2601 2699/2702 2799/2808 2899/2908 2999/3067 3099/3104 3199/3208 3299/3306 3399/3403 3499/3504 3599/3605 3699/3702 3799/3805 3899/3923 3999/4035 4099/4107 4199/4210 4299/4305 4399/4400 4499/4503 4599/4600 4699/4702 4799/4803 4899/4913 4999/5092 5094/5097 5099/5124 5199/5199 5300/5300 5400/5403 5500/5506 5999/5999 6001/6054 6056/6058 6061/6081 6085/6086 6089/6089 6091/6091 6093/6093 6095/6095 6097/6097 6099/6104 6999/6999 7001/7084 7086/7111 7113/7113 7999/7999 8001/8083 8600/8610 8700/8702 8800/8800 8900/8900 8999/8999 9001/9233 9999/9999 10001/10002 10004/10007 10009/10016 10999/10999 11078/11078 12003/12036 12999/12999 13001/13009 13999/13999 15001/15092 15094/15097 15099/15124 15999/15999 16001/16039 16041/16041 16999/16999 17001/17084 17086/17111 17113/17113 17999/17999 18001/18045 18999/18999 19001/19017 19999/19999 21001/21025 21999/21999 22001/22032 22999/22999 23001/23032 23999/23999 25001/25005 25999/25999 26001/26015 26999/26999 27001/27028 27999/27999 28001/28054 28056/28083 28999/28999 29001/29086 29088/29089 29999/29999 30001/30036 30999/30999 31001/31046 31999/31999 32001/32063 32065/32072 32074/32086 32999/32999 33001/33067 33999/33999 34001/34030 34999/34999 35001/35047 35999/35999 36001/36054 36999/36999 37001/37024 37999/37999 38001/38055 38999/38999 39001/39233 39999/39999 40001/40019 40999/40999 41002/41069 41071/41072 41999/41999 42001/42104 42999/42999 43001/43057 43999/43999 44001/44009 44999/44999 45001/45030 45999/45999 46001/46007 46999/46999 47003/47019 47021/47026 47028/47029 47999/47999 48004/48017 48019/48021 48023/48023 48025/48025 48027/48032 48034/48037 48999/48999 49001/49074 49076/49088 49090/49132 49999/49999 50001/50017 50999/50999 51001/51025 51999/51999 53001/53006 54001/54035 55001/55067 86001/86003 86007/86008 86011/86026 86028/86036 86039/86046 86048/86050 86052/86054 86056/86058 86061/86081 86085/86086 86089/86089 86091/86091 86093/86093 86095/86095 86097/86097 86099/86104 87001/87014 87016/87016 87018/87021 88001/88002 89001/89001
local Diminuição_do_passivo v_DT_3  10003/10003 10008/10008 48001/48003 48022/48022 48024/48024

/* Nível 0 */

local Despesa_Total v_DT_0  1/233 239/239 250/250 259/260 269/270 279/280 289/290 299/306 309/310 319/320 329/330 339/340 349/350 359/360 369/370 379/380 389/392 399/403 409/410 419/421 429/430 439/440 449/450 459/460 469/470 479/480 489/491 499/512 519/519 530/530 540/540 550/550 599/610 699/711 799/808 860/861 870/870 880/880 890/890 899/923 999/1080 1082/1110 1199/1203 1299/1300 1399/1399 1500/1512 1599/1604 1699/1711 1799/1804 1899/1901 1999/1999 2001/2104 2199/2203 2299/2303 2399/2399 2500/2500 2599/2601 2699/2702 2799/2808 2899/2908 2999/3067 3099/3104 3199/3208 3299/3306 3399/3403 3499/3504 3599/3605 3699/3702 3799/3805 3899/3923 3999/4035 4099/4107 4199/4210 4299/4305 4399/4400 4499/4503 4599/4600 4699/4702 4799/4803 4899/4913 4999/5124 5199/5199 5300/5300 5400/5403 5500/5506 5999/5999 6001/6054 6056/6058 6061/6081 6085/6086 6089/6089 6091/6091 6093/6093 6095/6095 6097/6097 6099/6104 6999/6999 7001/7084 7086/7111 7113/7113 7999/7999 8001/8083 8600/8610 8700/8702 8800/8800 8900/8900 8999/8999 9001/9233 9999/9999 10001/10016 10999/10999 11001/11080 11082/11104 11999/11999 12001/12036 12999/12999 13001/13009 13999/13999 15001/15124 15999/15999 16001/16039 16041/16041 16999/16999 17001/17084 17086/17111 17113/17113 17999/17999 18001/18045 18999/18999 19001/19017 19999/19999 21001/21025 21999/21999 22001/22032 22999/22999 23001/23032 23999/23999 25001/25005 25999/25999 26001/26015 26999/26999 27001/27028 27999/27999 28001/28054 28056/28083 28999/28999 29001/29086 29088/29089 29999/29999 30001/30036 30999/30999 31001/31046 31999/31999 32001/32063 32065/32072 32074/32086 32999/32999 33001/33067 33999/33999 34001/34030 34999/34999 35001/35047 35999/35999 36001/36054 36999/36999 37001/37024 37999/37999 38001/38055 38999/38999 39001/39233 39999/39999 40001/40019 40999/40999 41002/41069 41071/41072 41999/41999 42001/42104 42999/42999 43001/43057 43999/43999 44001/44009 44999/44999 45001/45030 45999/45999 46001/46007 46999/46999 47001/47029 47999/47999 48001/48017 48019/48037 48999/48999 49001/49074 49076/49088 49090/49132 49999/49999 50001/50017 50999/50999 51001/51025 51999/51999 53001/53006 54001/54035 55001/55067 86001/86003 86007/86008 86011/86026 86028/86036 86039/86046 86048/86050 86052/86054 86056/86058 86061/86081 86085/86086 86089/86089 86091/86091 86093/86093 86095/86095 86097/86097 86099/86104 87001/87014 87016/87016 87018/87021 88001/88002 89001/89001


*****************************************
** Rendimento (Tradutor de Rendimento) **
*****************************************

/* Nível 3 */

* Outras rendas

* Rendimento de aluguel

* Rendimento do Trabalho
local Conta_propria v_RE_113  53006/53006
local Empregado v_RE_111  53001/53004 54016/54017 54020/54022 54025/54026 54028/54028 54032/54034 55001/55002 55011/55011 55013/55015 55038/55040 55042/55043 55058/55058
local Empregador v_RE_112  53005/53005 55012/55012

* Transferência
local Aposentadoria_e_pensão_INSS v_RE_121  54004/54005 55003/55004 55050/55050
local Aposentadoria_pensão_prev_priv v_RE_123  54008/54008 54029/54029 55007/55007 55033/55033 55047/55047
local Aposentadoria_pensão_prev_pub v_RE_122  54006/54007 54031/54031 55005/55006 55064/55064
local Outras_Transferências v_RE_126  54003/54003 54009/54010 54023/54023 54027/54027 54030/54030 55009/55009 55017/55019 55027/55032 55034/55034 55036/55036 55045/55045 55049/55049 55051/55052 55054/55055 55059/55059 55062/55062 55065/55066
local Pensão_aliment_mesada_ou_doação v_RE_125  54011/54013 55057/55057 55063/55063
local Programas_sociais_federais v_RE_124  54001/54002 54024/54024 55056/55056

/* Nível 2 */

* Rendimento Total
local Outras_rendas v_RE_14  54018/54019 54035/54035 55041/55041 55046/55046 55048/55048 55060/55060 55067/55067
local Rendimento_de_aluguel v_RE_13  54014/54015
local Rendimento_do_Trabalho v_RE_11  53001/53006 54016/54017 54020/54022 54025/54026 54028/54028 54032/54034 55001/55002 55011/55015 55038/55040 55042/55043 55058/55058
local Transferência v_RE_12  54001/54013 54023/54024 54027/54027 54029/54031 55003/55007 55009/55009 55017/55019 55027/55034 55036/55036 55045/55045 55047/55047 55049/55052 55054/55057 55059/55059 55062/55066
local Rendimento_Não_Monetário v_RE_15

/* Nível 1 */
	// Rendimento Total inclui o Não Monetário
local Rendimento_Total v_RE_1  53001/53006 54001/54035 55001/55007 55009/55009 55011/55015 55017/55019 55027/55034 55036/55036 55038/55043 55045/55052 55054/55060 55062/55067
local Variação_Patrimonial v_RE_2

* Nível 0 *: Rendimento Total e Variação Patrimonial (v_RE_0)

/* Montando locals com os códigos e nomes das variáveis escolhidas */

foreach item in `sel'{

	local nome: word 1 of ``item'' // primeiro elemento v_XX_y
	local codigo: copy local `item'
	
	local codigo: list codigo - nome
	
	if "`item'" == "Rendimento_Não_Monetário"{
		local rend_nao_monet rend_nao_monet
	}
	else if "`item'" == "Variação_Patrimonial"{
		local var_patrimonial var_patrimonial
	} // Caso algum desses dois seja escolhido, os locais ficam marcados para calcular
	
	else{
	
		local codigos  `" `codigos' "`codigo'" "' /* Armazena o código de todos os itens selecionados. */
		local nomes `nomes' `nome'										
	}											
} /* Após isso temos locals da forma:
		`sel' = Arroz Feijão
		`nomes' = v_DA_1011 v_DA_1012
		`codigos' = "63001/63003 63018/63018 63033/63034 63052/63054" "63012/63017 63019/63019 63021/63026 63031/63031 63046/63046 63050/63050 63055/63056" 
	*/

di as input "Itens selecionados:" _newline "`sel'"

local rem Rendimento_Não_Monetário Variação_Patrimonial
local sel: list sel - rem // Remove da lista, já que eles não são calculados da mesma forma

if "`id'" == "dom" {
	loc variaveis_ID = "UF  COD_UPA NUM_DOM"
}
else if "`id'" == "uc" {
	loc variaveis_ID = "UF  COD_UPA NUM_DOM NUM_UC"
}
else if "`id'" == "pess" {
	loc variaveis_ID = "UF  COD_UPA NUM_DOM NUM_UC COD_INFORMANTE"
}

/* Agregação dos gastos */

tempfile gastos

* Preparando os TRs de consumo
forvalues i = 1/`: word count `trs''{
	local tr: word `i' of `trs'
	local base: word `i' of `temps'
	
	if "`tr'" != "tr2" & "`tr'" != "tr3" & "`tr'" != "tr4" & "`tr'" != "tr5" & "`tr'" != "tr6" & "`tr'" != "tr7"{
		continue // apenas os de gastos e rendimentos
	}
	
	use `base', clear
	
	gen long cod_item_aux = int(V9001/100) /* Variável identificadora dos bens
										Os tradutores omitem os últimos 2 dígitos */
	
	/* Códigos para padronizar os gastos (deflator, peso, anualização)
	 Dependendo do registro, a forma de calcular muda
	 Os códigos do programa abaixo reproduzem o que é feito no arquivo Memórias de Cálculo
	 Após essas transformações, os gastos podem ser simplesmente somados */
	
	gen valor_anual_def = .
	
	variavel_gastos, tr(`tr')
	
	keep `variaveis_ID' cod_item_aux valor_anual_def
	
	save `base', replace
}

clear

append using `temps'
save `gastos', replace	

tempfile despesas

/* Identificação dos gastos */
forvalues i = 1/`: word count `sel''{
	local item: word `i' of `sel'
	local nome: word `i' of `nomes'
	local codigo: word `i' of `codigos'
	
	use `gastos', clear
	
	di as text "`item'"
	
	qui{
		gen item = .
	
		foreach cod in `codigo'{
			foreach n of numlist `cod'{
				replace item = 1 if cod_item_aux == `n' 
			}
		}
		keep if item == 1
	}	
	
	/* Agregação */
	cap collapse (sum) valor_anual_def, by(`variaveis_ID')
	if _rc == 2000{
		di as error "Sem observações para `item' a esse nível de id"				
		continue
	}
	else if _rc != 0 exit _rc
	
	local tipo = substr("`nome'", 3, 2) // v_DA_xx -> DA, v_RE_xx -> RE
	
	if "`tipo'" != "RE" label var valor_anual_def "Despesa com `item'"
	else label var valor_anual_def "Rendimento com `item'"
	
	rename valor_anual_def `nome'
	
	if `i' > 1 qui merge 1:1 `variaveis_ID' using `despesas', nogen
	
	qui save `despesas', replace
}

if `: word count `sel'' == 0{
	keep `variaveis_ID'
	duplicates drop // Caso o usuário escolha somente Rendimento Não Monetário por ex,
					// que é calculado à parte, como a base não foi colapsada ela tem que ser
					// posta no nível de agregação certo para merges futuros
}

qui save `despesas', replace

tempfile base_dom
load_pof17, trs(tr8) temps(`base_dom') original(`original') `english'

if "`id'" == "dom" merge 1:1 `variaveis_ID' using `despesas', nogen

else merge 1:m UF COD_UPA NUM_DOM using `despesas', nogen

if "`id'" == "pess"{
	tempfile base_morador
	load_pof17, trs(tr1) temps(`base_morador') original(`original') `english'
	
	merge m:1 `variaveis_ID' using `despesas', nogen
}

tempfile base_final
qui save `base_final', replace

/* Cálculos Adicionais */

if "`rend_nao_monet'" != ""{
	di as text "Renda Não Monetária"

	tempfile rend_nao_monet
	qui calc_rend_nao_monet, id(`id') original(`original') temp(`rend_nao_monet') `english'
	
	if "`id'" != "pess" merge 1:1 `variaveis_ID' using `base_final', nogen
	else merge 1:m UF COD_UPA NUM_DOM NUM_UC using `base_final', nogen
	
	qui save `base_final', replace
}
if "`var_patrimonial'" != ""{
	di as text "Variação Patrimonial"

	tempfile var_patrimonial
	qui calc_var_patrimonial, id(`id') original(`original') temp(`var_patrimonial') `english'
	
	if "`id'" != "pess" merge 1:1 `variaveis_ID' using `base_final', nogen
	else merge 1:m UF COD_UPA NUM_DOM NUM_UC using `base_final', nogen
	
	qui save `base_final', replace
}
	
end

program variavel_gastos
syntax, tr(string)

/* Tabela de Despesa Geral */

if "`tr'" == "tr5"{ // Aluguel Estimado
	replace valor_anual_def = V8000_DEFLA * V9011 * FATOR_ANUALIZACAO
}
if "`tr'" == "tr2"{ // Despesa Coletiva
	replace valor_anual_def = V8000_DEFLA * V9011 * FATOR_ANUALIZACAO /*
					*/ if QUADRO == 10 | QUADRO == 19
	replace valor_anual_def = V8000_DEFLA * V9011 * FATOR_ANUALIZACAO /*
					*/ if QUADRO != 10 & QUADRO != 19
	gen inss_anual = V1904_DEFLA * V9011 * FATOR_ANUALIZACAO				
}

if "`tr'" == "tr3"{ // Caderneta Coletiva
	replace valor_anual_def = V8000_DEFLA * FATOR_ANUALIZACAO
}
if "`tr'" == "tr4"{ // Despesa Individual
	replace valor_anual_def = V8000_DEFLA * V9011 * FATOR_ANUALIZACAO /*
					*/ if QUADRO == 44 | QUADRO == 47 | QUADRO == 48 | /*
					*/ QUADRO == 49 | QUADRO == 50
	replace valor_anual_def = V8000_DEFLA * FATOR_ANUALIZACAO /*
					*/ if !(QUADRO == 44 | QUADRO == 47 | QUADRO == 48 | /*
					*/ QUADRO == 49 | QUADRO == 50)			
}

/* Tabela de Rendimento */

if "`tr'" == "tr6"{ // Rendimento do Trabalho
	replace valor_anual_def = V8500_DEFLA * V9011 * FATOR_ANUALIZACAO
}
if "`tr'" == "tr7"{ // Outros Rendimentos
	replace valor_anual_def = V8500_DEFLA * V9011 * FATOR_ANUALIZACAO if QUADRO == 54
	replace valor_anual_def = V8500_DEFLA * FATOR_ANUALIZACAO if QUADRO != 54
}

end

program calc_deducoes
syntax, 

if "`tr'" == "tr6"{ // Rendimento do Trabalho
	* "valores de deduções com previdência pública, imposto de renda, e ISS e outros impostos..."
	gen prev_pub_anual = V531112_DEFLA * V9011 * FATOR_ANUALIZACAO
	gen imp_renda_anual = V531122_DEFLA * V9011 * FATOR_ANUALIZACAO
	gen iss_anual = V531132_DEFLA * V9011 * FATOR_ANUALIZACAO
}
if "`tr'" == "tr7"{ // Outros Rendimentos
	gen deducao_anual = .
	replace deducao_anual = V8501_DEFLA * V9011 * FATOR_ANUALIZACAO if QUADRO == 54
	replace deducao_anual = V8501_DEFLA * FATOR_ANUALIZACAO if QUADRO != 54
}

end

program calc_rend_nao_monet // Monta a base com a renda não monetária e salva no local `temp'
syntax, id(string) original(string) temp(string) [english]

/* Tabela de Rendimento Não Monetário

	Cálculo seguindo o arquivo Rendimento Não Monetário da pasta Memórias de Cálculo
	
	1. Para cada UC, soma os valores de despesa não monetária
	2. Calcula aluguel estimado
	3. Diferença entre aluguel estimado e algumas despesas monetárias
	4. Soma despesas não monetárias com diferença
	
*/	

if "`id'" == "dom" {
	loc variaveis_ID = "UF  COD_UPA NUM_DOM"
}
else {
	loc variaveis_ID = "UF  COD_UPA NUM_DOM NUM_UC" // Como usa o registro de Aluguéis Estimado,
													// só é possível calcular a nível de UC
}

/* Parte 1: Extraindo despesas não monetárias e somando */

* Despesa Coletiva

load_pof17, trs(tr2) temps(`temp') original(`original') `english'

gen desp_nao_monet  = .
replace desp_nao_monet = V8000_DEFLA * V9011 * FATOR_ANUALIZACAO /*
					*/ if (V9002 >= 7 & V9002 <= 11) & (QUADRO == 10 | QUADRO == 19)
replace desp_nao_monet = V8000_DEFLA * FATOR_ANUALIZACAO /*
					*/ if (V9002 >= 7 & V9002 <= 11) & !(QUADRO == 10 | QUADRO == 19)
					
save `temp', replace					

* Caderneta Coletiva

tempfile extra

load_pof17, trs(tr3) temps(`extra') original(`original') `english'

gen desp_nao_monet  = .
replace desp_nao_monet = V8000_DEFLA * FATOR_ANUALIZACAO if V9002 >= 7 & V9002 <= 11

append using `temp'

* Despesa Individual

load_pof17, trs(tr4) temps(`extra') original(`original') `english'

gen desp_nao_monet  = .
replace desp_nao_monet = V8000_DEFLA * V9011 * FATOR_ANUALIZACAO /*
					*/ if (QUADRO == 44 | QUADRO == 47 | QUADRO == 48 | /*
					*/ QUADRO == 49 | QUADRO == 50) & (V9002 >= 7 & V9002 <= 11)
replace desp_nao_monet = V8000_DEFLA * FATOR_ANUALIZACAO /*
					*/ if !(QUADRO == 44 | QUADRO == 47 | QUADRO == 48 | /*
					*/ QUADRO == 49 | QUADRO == 50)	& (V9002 >= 7 & V9002 <= 11)
						
append using `temp'			

/* Somando todos os valores de despeda não monetária */

collapse (sum) desp_nao_monet, by(`variaveis_ID')

save `temp', replace

/* Parte 2: Extraindo aluguel estimado */

load_pof17, trs(tr5) temps(`extra') original(`original') `english'

gen aluguel_estimado = V8000_DEFLA * V9011 * FATOR_ANUALIZACAO 			

collapse (sum) aluguel_estimado, by(`variaveis_ID')

merge 1:1 `variaveis_ID' using `temp', nogen

save `temp', replace

/* Parte 3: Subtraindo algumas despesas monetárias */

* Despesa Coletiva

load_pof17, trs(tr2) temps(`extra') original(`original') `english'

gen codigo = int(V9001/100)

local valores 8001/8024 8026/8068 8999 10006 10011 12005/12008 12010/12015 12017/12020 12023/12025 12027/12036 12999

gen inlist = .

foreach n of numlist `valores'{
	qui replace inlist = 1 if codigo == `n'  
}	

keep if V9002 <= 6 & inlist == 1

drop codigo inlist

gen valor_subtracao  = .
replace valor_subtracao = V8000_DEFLA * V9011 * FATOR_ANUALIZACAO /*
					*/ if QUADRO == 10
replace valor_subtracao = V8000_DEFLA * FATOR_ANUALIZACAO /*
					*/ if QUADRO != 10
					
collapse (sum) valor_subtracao, by(`variaveis_ID')	
merge 1:1 `variaveis_ID' using `temp', nogen

replace aluguel_estimado = 0 if missing(aluguel_estimado)
replace valor_subtracao = 0 if missing(valor_subtracao)		

gen dif = aluguel_estimado -  valor_subtracao
replace dif = . if dif <= 0

/* Parte 4: Somando */

replace desp_nao_monet = 0 if missing(desp_nao_monet)
replace dif = 0 if missing(dif)

gen rend_nao_monet = desp_nao_monet + dif	

local suffix = cond("`id'" == "dom", "do Domicílio", "da Unidade de Consumo")
label var rend_nao_monet "Rendimento não monetário estimado `suffix'"

drop desp_nao_monet aluguel_estimado valor_subtracao dif

rename rend_nao_monet v_RE_15 // Código na tabela

save `temp', replace

end

program calc_var_patrimonial // Monta a base de variação patrimonial e salva no local `temp'
syntax, id(string) original(string) temp(string) [english]

/* Tabela de Variação Patrimonial

	Cálculo seguindo o arquivo Variação Patrimonial da pasta Memórias de Cálculo
	
	1. Soma os valores de uma lista de itens

*/	

if "`id'" == "dom" {
	loc variaveis_ID = "UF  COD_UPA NUM_DOM"
}
else if "`id'" == "uc" {
	loc variaveis_ID = "UF  COD_UPA NUM_DOM NUM_UC"
}
else {
	loc variaveis_ID = "UF  COD_UPA NUM_DOM NUM_UC COD_INFORMANTE"
}

/* Parte 1: Extraindo despesas não monetárias e somando */

* Outros Rendimentos

load_pof17, trs(tr7) temps(`temp') original(`original') `english'

gen codigo = int(V9001/100)

gen var_patrimonial = .
replace var_patrimonial = V8500_DEFLA * V9011 * FATOR_ANUALIZACAO /*
					*/ if QUADRO == 54
replace var_patrimonial = V8500_DEFLA * FATOR_ANUALIZACAO /*
					*/ if QUADRO != 54

qui save `temp', replace					
					
* Mantém apenas alguns itens

local valores 55008 55010 55016 55020/55026 55035 55037 55044 55053 55061	

gen inlist = .

foreach n of numlist `valores'{
	qui replace inlist = 1 if codigo == `n'  
}

keep if inlist == 1

collapse (sum) soma_1 = var_patrimonial, by(`variaveis_ID')

tempfile parte1
qui save `parte1', replace			

* Calcula a diferença entre alguns códigos

* 57001 e 56001

use `temp', clear

by `variaveis_ID': egen cod57001 = total(var_patrimonial) if codigo == 57001
by `variaveis_ID': egen cod56001 = total(var_patrimonial) if codigo == 56001

replace cod57001 = 0 if missing(cod57001)
replace cod56001 = 0 if missing(cod56001)

gen dif1 = cod57001 - cod56001
replace dif1 = . if dif1 <= 0

* 57002 e 56002

by `variaveis_ID': egen cod57002 = total(var_patrimonial) if codigo == 57002
by `variaveis_ID': egen cod56002 = total(var_patrimonial) if codigo == 56002

replace cod57002 = 0 if missing(cod57002)
replace cod56002 = 0 if missing(cod56002)

gen dif2 = cod57002 - cod56002
replace dif2 = . if dif2 <= 0

* 57003 e 56003

by `variaveis_ID': egen cod57003 = total(var_patrimonial) if codigo == 57003
by `variaveis_ID': egen cod56003 = total(var_patrimonial) if codigo == 56003

replace cod57003 = 0 if missing(cod57003)
replace cod56003 = 0 if missing(cod56003)

gen dif3 = cod57003 - cod56003
replace dif3 = . if dif3 <= 0

* 57004 e 56004

by `variaveis_ID': egen cod57004 = total(var_patrimonial) if codigo == 57004
by `variaveis_ID': egen cod56004 = total(var_patrimonial) if codigo == 56004

replace cod57004 = 0 if missing(cod57004)
replace cod56004 = 0 if missing(cod56004)

gen dif4 = cod57004 - cod56004
replace dif4 = . if dif4 <= 0

* Somando as diferenças

collapse (sum) dif1 dif2 dif3 dif4, by(`variaveis_ID')

replace dif1 = 0 if missing(dif1)
replace dif2 = 0 if missing(dif2)
replace dif3 = 0 if missing(dif3)
replace dif4 = 0 if missing(dif4)

gen soma_2 = dif1 + dif2 + dif3 + dif4

drop dif1 dif2 dif3 dif4 cod57001 cod56001 cod57002 cod56002 cod57003 cod56003 cod57004 cod56004 var_patrimonial

merge 1:1 `variaveis_ID' using `parte1', nogen

replace soma_1 = 0 if missing(soma_1)
replace soma_2 = 0 if missing(soma_2)

gen v_RE_2 = soma_1 + soma_2

qui save `temp', replace

end

program pofstd_17
syntax, id(string) trs(string) temps(string) original(string) [english]

/* Inclui:
	- Despesas Alimentares de nível 2 (v_DA_xxx)
	- Despesas Gerais de nível 4 (v_DT_xxxxxx)
	- Despesas Gerais de nível 3 que não têm subdivisão no nível 4 (v_DT_xxxx)
	- Despesas Gerais de nível 2 que não têm subdivisão
	- Rendimentos de nível 3
	- Rendimentos restantes de nível 2
*/

local gastos_selecionados Alimentação_light_e_diet Almoço_e_jantar Café_leite_caféleite_chocolate Cervejas_chopes_outras_alcool Lanches Outras_alimentacao_fora_Dom /*
	*/ Refrigerantes_e_outras_nãoalcoo Sanduíches_e_salgados /* Alimentação fora do domicílio
	
	*/ Alimentos_preparados Aves_e_ovos Açúcares_e_derivados Bebidas_e_infusões Carnes_vísceras_e_pescados Cereais_leguminosas_oleaginosas Enlatados_e_conservas /*
	*/ Farinhas_féculas_e_massas Frutas Legumes_e_verduras Leites_e_derivados Outros_alimentacao_no_Dom Panificados Sal_e_condimentos Tubérculos_e_raízes /*
	*/ Óleos_e_gorduras /* Alimentação fora do domicílio
	
	*/ Consulta_e_tratamento_dentario Consulta_medica Exames_diversos Hospitalizacao Material_de_tratamento Outras_assistencia_saude Plano_seguro_saude /*
	*/ Remedios Servico_de_cirurgia Tratamento_medico_e_ambulatoria /* Assistência à saúde
	
	*/ Cerimônias_e_festas Comunicação Imóveis_de_uso_ocasional Jogos_e_apostas Outras_despesas_diversas Serviços_profissionais /* Despesas diversas 
	
	*/ Artigos_escolares Cursos_regulares Cursos_superiores Livros_didaticos_e_revistas_tec Outras_educacao Outros_cursos_e_atividades /* Educação
	
	*/ Aluguel Artigos_de_limpeza Condominio Consertos_de_artigos_do_lar Eletrodomesticos Manutencao_do_lar Mobiliario_e_artigos_do__lar Servicos_e_taxas /* Habitação 
	
	*/ Instrumentos_produt_uso_pessoal Perfume Produtos_para_cabelo Sabonete /* Higiene e cuidados pessoais 
	
	*/ Brinquedos_e_jogos Celular_e_acessórios Outras_recreacao_cultura Periódicos_livros_revistas_nãod Recreações_e_esportes /* Recreação e cultura 
	
	*/ Cabeleireiro Conserto_de_artigos_pessoais Manicure_e_pedicure Outras_servicos_pessoais /* Serviços pessoais 
	
	*/ Aquisicao_de_veiculos Gasolina_veiculo_proprio Manutencao_e_acessorios Outras_transporte Transporte_Urbano Viagens_esporadicas Álcool_veículo_próprio /* Transporte 
	
	*/ Calcados_e_apetrechos Joias_e_bijuterias Roupa_de_crianca Roupa_de_homem Roupa_de_mulher Tecidos_e_armarinhos /* Vestuário
	
	*/ Fumo /* Despesas de Consumo
	
	*/ Contribuições_trabalhistas Impostos Outras_outras_desp_correntes Pensões_mesadas_e_doações Previdência_privada Serviços_bancários /* Outras despesas correntes 
	
	*/ Imóvel_aquisição Imóvel_reforma Outros_investimentos /* Aumento do ativo
	
	*/ Empréstimo Prestação_de_imóvel /* Diminuição do passivo 
	
	*/ Conta_propria Empregado Empregador /* Rendimento do Trabalho 
	
	*/ Aposentadoria_e_pensão_INSS Aposentadoria_pensão_prev_priv Aposentadoria_pensão_prev_pub Outras_Transferências Pensão_aliment_mesada_ou_doação Programas_sociais_federais /* Transferência
	
	*/ Outras_rendas Rendimento_de_aluguel Rendimento_Não_Monetário Variação_Patrimonial

* Alguns gastos só existem nas despesas coletivas	
	
local faltantes_pess Alimentos_preparados Aves_e_ovos Açúcares_e_derivados Bebidas_e_infusões Carnes_vísceras_e_pescados Cereais_leguminosas_oleaginosas /*
	*/ Enlatados_e_conservas Farinhas_féculas_e_massas Frutas Legumes_e_verduras Leites_e_derivados Outros_alimentacao_no_Dom Panificados Sal_e_condimentos /*
	*/ Tubérculos_e_raízes Óleos_e_gorduras Aluguel Condominio Manutencao_do_lar Imóvel_reforma Prestação_de_imóvel

if "`id'" == "pess" local gastos_selecionados: list gastos_selecionados - faltantes_pess

	
pofsel_17, id(`id') sel(`gastos_selecionados') trs(`trs') temps(`temps') original(`original') `english'

end
